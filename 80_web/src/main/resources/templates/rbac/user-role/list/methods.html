<th:block th:fragment="parts">
<script th:inline="javascript">
    var moduleApi = /*[[${moduleApi}]]*/ "";
    var userId = /*[[${userId}]]*/ "";
    var moduleCode = /*[[${moduleCode}]]*/ "";
    methods.loadPageData = function(pageNo) {
        var param = {
            systemId: store.systemId,
            keyword: store.keyword,
            userId: userId,
            pageNo: pageNo,
            pageSize: 15
        };
        httpClient.postJson(`/${moduleApi}/queryPage`,  param ,function(op){
            if (!op.success){
                window.vue.$Notice.error({title: '系统错误', desc: op.message})
                setTimeout(function (){
                    window.vue.$Loading.error();
                }, 100)
                return;
            }
            store.rows = op.data.rows;
            store.totalSize = op.data.totalSize;
        })
        store.pageNo = pageNo;
    }
    methods.addNew = function() {
        store.formItem = {}
        store.modalEdit = true
    }
    methods.edit = function(row) {
        store.formItem = row
        store.modalEdit = true
    }
    methods.allowUserRole = function(rows, selectedRows) {
        var param = {
            userId: userId,
            rows: rows,
            selectedRows: selectedRows
        }
        httpClient.postJson(`/${moduleApi}/allowUserRole`, param ,function(op){
            if (!op.success){
                window.vue.$Notice.error({title: '系统错误', desc: op.message})
                setTimeout(function (){
                    window.vue.$Loading.error();
                }, 100)
                return;
            }
            window.vue.$Notice.info({title: "分配成功"})
            methods.loadPageData(store.pageNo)
        })
    }
    methods.cancel = function() {

    }
    methods.pageChange = function (pageNo) {
        methods.loadPageData(pageNo);
    };


    methods.onSelectChange = function(selectRows) {
        console.log("selectRows => ", selectRows)
        methods.allowUserRole(store.rows, selectRows)
    }

    methods.systemChange = function(value) {
        window.location.href = `/${moduleCode}/list?systemId=${value}&userId=${userId}`
    }

</script>
</th:block>